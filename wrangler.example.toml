# Rushomon Cloudflare Worker Configuration
# Copy this file to wrangler.toml and update the values below for your setup

name = "rushomon"
main = "build/worker/shim.mjs"
compatibility_date = "2026-02-10"
upload_source_maps = true

# Observability configuration
[observability]
enabled = true
head_sampling_rate = 1

[observability.traces]
enabled = true
head_sampling_rate = 0.1

[build]
command = "cargo install -q worker-build && worker-build --release"

# KV Namespace for URL mappings
# Run: wrangler kv:namespace create "URL_MAPPINGS"
# Then update the id below with the returned namespace ID
[[kv_namespaces]]
binding = "URL_MAPPINGS"
id = "your-kv-namespace-id-here"
preview_id = "your-preview-kv-id-here"

# D1 Database for metadata and analytics
# Run: wrangler d1 create rushomon
# Then update the database_id below with the returned ID
[[d1_databases]]
binding = "rushomon"
database_name = "rushomon"
database_id = "your-database-id-here"

# Environment variables (non-sensitive)
[vars]
GITHUB_CLIENT_ID = "your-github-oauth-app-client-id"
GITHUB_AUTHORIZE_URL = "https://github.com/login/oauth/authorize"
GITHUB_TOKEN_URL = "https://github.com/login/oauth/access_token"
GITHUB_USER_URL = "https://api.github.com/user"
GOOGLE_CLIENT_ID = "your-google-oauth-client-id"
GOOGLE_AUTHORIZE_URL = "https://accounts.google.com/o/oauth2/v2/auth"
GOOGLE_TOKEN_URL = "https://oauth2.googleapis.com/token"
GOOGLE_USER_URL = "https://openidconnect.googleapis.com/v1/userinfo"
DOMAIN = "yourdomain.com"
FRONTEND_URL = "http://localhost:5173"
# KV-based rate limiting is disabled by default in favor of Cloudflare rate limiting rules
# Set to "true" to re-enable KV-based rate limiting for specific use cases
ENABLE_KV_RATE_LIMITING = "false"

# CORS configuration
# Comma-separated list of allowed origins
ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:5174,https://your-frontend.pages.dev"

[assets]
directory = "./frontend/build"
binding = "ASSETS"
run_worker_first = true
not_found_handling = "none"

# Secrets (sensitive values - set via wrangler secret put)
# Run these commands to set secrets:
# wrangler secret put GITHUB_CLIENT_SECRET
# wrangler secret put GOOGLE_CLIENT_SECRET
# wrangler secret put JWT_SECRET (use a random 32+ character string)
